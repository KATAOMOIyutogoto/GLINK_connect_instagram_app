# ğŸ“Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚µãƒãƒªãƒ¼

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**åå‰**: GLINK Instagram OAuth  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 0.1.0  
**ç›®çš„**: Instagramå…¬å¼APIé€£æºï¼ˆOAuthï¼‰ã«ã‚ˆã‚‹è¤‡æ•°ãƒ—ãƒ­ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å®‰å…¨ãªæ¥ç¶šç®¡ç†  
**å¯¾è±¡**: ç¤¾å†…é‹ç”¨ï¼ˆã‚¹ã‚¿ãƒƒãƒ•ãŒã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ¥ç¶šã—ã€BotãŒãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ï¼‰

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ |
|---------|------|
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | Next.js 14 (App Router) |
| è¨€èª | TypeScript |
| ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° | Tailwind CSS |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | Supabase (Postgres) |
| æš—å·åŒ– | Web Crypto API (AES-256-GCM) |
| OAuth | Instagram Basic Display API / Instagram Graph API |
| ãƒ‡ãƒ—ãƒ­ã‚¤ | Vercel (Serverless) |

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
GLINK_v2/
â”œâ”€â”€ ğŸ“„ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ package.json          # ä¾å­˜é–¢ä¿‚ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ tsconfig.json         # TypeScriptè¨­å®š
â”‚   â”œâ”€â”€ next.config.js        # Next.jsè¨­å®š
â”‚   â”œâ”€â”€ tailwind.config.ts    # Tailwindè¨­å®š
â”‚   â”œâ”€â”€ postcss.config.js     # PostCSSè¨­å®š
â”‚   â”œâ”€â”€ vercel.json           # Vercelè¨­å®š
â”‚   â”œâ”€â”€ .gitignore            # Gité™¤å¤–è¨­å®š
â”‚   â””â”€â”€ env.example           # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚
â”œâ”€â”€ ğŸ“± ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (app/)
â”‚   â”œâ”€â”€ page.tsx              # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ layout.tsx            # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ globals.css           # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â”œâ”€â”€ connect/
â”‚   â”‚   â””â”€â”€ page.tsx          # Instagramæ¥ç¶šç”»é¢
â”‚   â”œâ”€â”€ connected/
â”‚   â”‚   â””â”€â”€ page.tsx          # æ¥ç¶šæ¸ˆã¿ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§
â”‚   â””â”€â”€ api/instagram/
â”‚       â”œâ”€â”€ login/route.ts    # OAuthé–‹å§‹
â”‚       â”œâ”€â”€ callback/route.ts # OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
â”‚       â”œâ”€â”€ status/route.ts   # ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§API
â”‚       â””â”€â”€ refresh/route.ts  # ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°API
â”‚
â”œâ”€â”€ ğŸ›  ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (lib/)
â”‚   â”œâ”€â”€ crypto.ts             # æš—å·åŒ–/å¾©å·åŒ–
â”‚   â”œâ”€â”€ supabaseAdmin.ts      # Supabaseç®¡ç†ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ repo/
â”‚   â”‚   â””â”€â”€ instagramRepo.ts  # Instagram ãƒ‡ãƒ¼ã‚¿ãƒªãƒã‚¸ãƒˆãƒª
â”‚   â””â”€â”€ instagram.ts          # Instagram API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚
â”œâ”€â”€ ğŸ—„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (supabase/)
â”‚   â””â”€â”€ schema.sql            # Postgresã‚¹ã‚­ãƒ¼ãƒ
â”‚
â”œâ”€â”€ ğŸ“ å‹å®šç¾© (types/)
â”‚   â””â”€â”€ index.ts              # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®å‹
â”‚
â”œâ”€â”€ âš™ï¸ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (scripts/)
â”‚   â”œâ”€â”€ generate-encryption-key.js  # æš—å·åŒ–ã‚­ãƒ¼ç”Ÿæˆ
â”‚   â””â”€â”€ check-env.js                # ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯
â”‚
â””â”€â”€ ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â”œâ”€â”€ README.md             # ãƒ¡ã‚¤ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â”œâ”€â”€ QUICKSTART.md         # ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰
    â”œâ”€â”€ DEPLOYMENT.md         # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰
    â”œâ”€â”€ CONTRIBUTING.md       # è²¢çŒ®ã‚¬ã‚¤ãƒ‰
    â”œâ”€â”€ CHANGELOG.md          # å¤‰æ›´å±¥æ­´
    â”œâ”€â”€ LICENSE               # ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
    â””â”€â”€ PROJECT_SUMMARY.md    # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ä¸»è¦æ©Ÿèƒ½

### âœ… å®Ÿè£…æ¸ˆã¿

1. **OAuth èªè¨¼ãƒ•ãƒ­ãƒ¼**
   - Instagram Login ã¸ã®å®‰å…¨ãªãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   - state ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚ˆã‚‹ CSRF å¯¾ç­–
   - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã¨ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›

2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
   - AES-256-GCM ã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ãƒ³æš—å·åŒ–
   - HttpOnly / Secure / SameSite Cookie
   - ãƒ­ã‚°ã¸ã®ãƒˆãƒ¼ã‚¯ãƒ³å‡ºåŠ›ã®é˜²æ­¢

3. **ãƒ‡ãƒ¼ã‚¿ç®¡ç†**
   - Vercel KV ã«ã‚ˆã‚‹æ°¸ç¶šåŒ–
   - è¤‡æ•°ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç®¡ç†
   - æ¥ç¶šæ—¥æ™‚ã¨ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™ã®è¨˜éŒ²

4. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**
   - ã‚·ãƒ³ãƒ—ãƒ«ã§åˆ†ã‹ã‚Šã‚„ã™ã„UI
   - æ¥ç¶šæ¸ˆã¿ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§è¡¨ç¤º
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

5. **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**
   - `/api/instagram/login` - OAuthé–‹å§‹
   - `/api/instagram/callback` - OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
   - `/api/instagram/status` - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§å–å¾—
   - `/api/instagram/refresh` - ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°

6. **é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«**
   - æš—å·åŒ–ã‚­ãƒ¼ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
   - ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
   - è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ğŸš§ ä»Šå¾Œã®æ‹¡å¼µï¼ˆå®Ÿè£…äºˆå®šï¼‰

1. **è‡ªå‹•ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°**
   - Vercel Cron Jobs ã«ã‚ˆã‚‹å®šæœŸå®Ÿè¡Œ
   - æœŸé™ãŒè¿‘ã„ãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•æ¤œå‡º
   - ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å¤±æ•—æ™‚ã®é€šçŸ¥

2. **Bot ç”¨ API**
   - ãƒ¡ãƒ‡ã‚£ã‚¢å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
   - ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
   - ã‚¤ãƒ³ã‚µã‚¤ãƒˆå–å¾—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

3. **ç®¡ç†æ©Ÿèƒ½**
   - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤æ©Ÿèƒ½
   - ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™ã‚¢ãƒ©ãƒ¼ãƒˆ
   - ç®¡ç†è€…èªè¨¼

4. **ç›£è¦–ãƒ»ãƒ­ã‚°**
   - Sentry é€£æº
   - ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°
   - ã‚¨ãƒ©ãƒ¼ã‚¢ãƒ©ãƒ¼ãƒˆ

## ç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å | èª¬æ˜ | å¿…é ˆ |
|--------|------|------|
| `IG_APP_ID` | Instagram App ID | âœ… |
| `IG_APP_SECRET` | Instagram App Secret | âœ… |
| `IG_REDIRECT_URI` | OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ URI | âœ… |
| `IG_SCOPES` | è¦æ±‚ã™ã‚‹ã‚¹ã‚³ãƒ¼ãƒ— | âœ… |
| `ENCRYPTION_KEY_BASE64` | æš—å·åŒ–ã‚­ãƒ¼ (32 bytes) | âœ… |
| `NEXT_PUBLIC_SUPABASE_URL` | Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ URL | âœ… |
| `SUPABASE_SERVICE_ROLE_KEY` | Supabase Service Role Key | âœ… |

## NPM ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|---------|------|
| `npm run dev` | é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹• |
| `npm run build` | æœ¬ç•ªãƒ“ãƒ«ãƒ‰ |
| `npm run start` | æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼èµ·å‹• |
| `npm run lint` | ã‚³ãƒ¼ãƒ‰ãƒªãƒ³ãƒˆ |
| `npm run generate-key` | æš—å·åŒ–ã‚­ãƒ¼ç”Ÿæˆ |
| `npm run check-env` | ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯ |
| `npm run setup` | ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆã‚­ãƒ¼ç”Ÿæˆ+ãƒã‚§ãƒƒã‚¯ï¼‰ |

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

```powershell
# 1. ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 2. æš—å·åŒ–ã‚­ãƒ¼ã‚’ç”Ÿæˆ
npm run generate-key

# 3. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
Copy-Item env.example .env.local
# .env.local ã‚’ç·¨é›†

# 4. ç’°å¢ƒå¤‰æ•°ã‚’ãƒã‚§ãƒƒã‚¯
npm run check-env

# 5. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
npm run dev
```

è©³ç´°ã¯ [QUICKSTART.md](./QUICKSTART.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

- âœ… ãƒˆãƒ¼ã‚¯ãƒ³ã¯å¿…ãšæš—å·åŒ–ã—ã¦ä¿å­˜
- âœ… ç’°å¢ƒå¤‰æ•°ã‚’çµ¶å¯¾ã«å…¬é–‹ã—ãªã„
- âœ… HTTPS ã‚’æœ¬ç•ªç’°å¢ƒã§ä½¿ç”¨
- âœ… OAuth state ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¤œè¨¼
- âœ… ãƒ­ã‚°ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‡ºåŠ›ã—ãªã„
- âœ… HttpOnly Cookie ã‚’ä½¿ç”¨

## ãƒ‡ãƒ—ãƒ­ã‚¤

### Vercel ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```powershell
# Vercel CLI ã§ãƒ‡ãƒ—ãƒ­ã‚¤
vercel

# æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤
vercel --prod
```

è©³ç´°ã¯ [DEPLOYMENT.md](./DEPLOYMENT.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ãƒ¦ãƒ¼ã‚¶ãƒ¼   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js App Router    â”‚
â”‚  (Vercel Serverless)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Pages:                 â”‚
â”‚  - / (Home)             â”‚
â”‚  - /connect             â”‚
â”‚  - /connected           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API Routes:            â”‚
â”‚  - /api/instagram/login â”‚
â”‚  - /api/instagram/      â”‚
â”‚    callback             â”‚
â”‚  - /api/instagram/      â”‚
â”‚    status               â”‚
â”‚  - /api/instagram/      â”‚
â”‚    refresh              â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
    â”‚              â”‚
    â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Instagram â”‚  â”‚  Vercel KV   â”‚
â”‚   API    â”‚  â”‚  (Redis)     â”‚
â”‚          â”‚  â”‚              â”‚
â”‚ - OAuth  â”‚  â”‚ - Encrypted  â”‚
â”‚ - Graph  â”‚  â”‚   Tokens     â”‚
â”‚   API    â”‚  â”‚ - Account    â”‚
â”‚          â”‚  â”‚   Metadata   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### Vercel KV ã‚­ãƒ¼æ§‹é€ 

```
ig:account:index            # Set: å…¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID
ig:account:{igUserId}       # Hash: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±

# ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã®æ§‹é€ 
{
  igUserId: string
  username?: string
  encryptedToken: string    # AES-256-GCM ã§æš—å·åŒ–
  tokenType: string
  expiresIn?: number
  connectedAt: string       # ISO 8601
  tokenExpiresAt?: string   # ISO 8601
  lastRefreshedAt?: string  # ISO 8601
}
```

## ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚³ãƒ¼ãƒ—

| ã‚¹ã‚³ãƒ¼ãƒ— | èª¬æ˜ |
|---------|------|
| `instagram_basic` | åŸºæœ¬çš„ãªãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ± |
| `pages_read_engagement` | ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Š |
| `instagram_content_publish` | ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æŠ•ç¨¿ï¼ˆæ‹¡å¼µäºˆå®šï¼‰ |
| `instagram_manage_insights` | ã‚¤ãƒ³ã‚µã‚¤ãƒˆã®ç®¡ç†ï¼ˆæ‹¡å¼µäºˆå®šï¼‰ |

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- âš¡ Vercel Edge Network ã«ã‚ˆã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«é…ä¿¡
- âš¡ Serverless Functions ã§è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
- âš¡ Redis (KV) ã«ã‚ˆã‚‹é«˜é€Ÿãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
- âš¡ æœ€å°é™ã®ä¾å­˜é–¢ä¿‚

## ãƒ–ãƒ©ã‚¦ã‚¶ã‚µãƒãƒ¼ãƒˆ

- âœ… Chrome / Edge (æœ€æ–°ç‰ˆ)
- âœ… Firefox (æœ€æ–°ç‰ˆ)
- âœ… Safari (æœ€æ–°ç‰ˆ)
- âšª IE11 (éå¯¾å¿œ)

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License - è©³ç´°ã¯ [LICENSE](./LICENSE) ã‚’å‚ç…§

## è²¢çŒ®

è²¢çŒ®æ–¹æ³•ã¯ [CONTRIBUTING.md](./CONTRIBUTING.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚µãƒãƒ¼ãƒˆ

- ğŸ“§ Email: support@your-company.com
- ğŸ“ Issues: [GitHub Issues](https://github.com/your-org/glink-instagram-oauth/issues)
- ğŸ’¬ Discussions: [GitHub Discussions](https://github.com/your-org/glink-instagram-oauth/discussions)

---

**æœ€çµ‚æ›´æ–°**: 2026-01-19  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 0.1.0  
**ä½œæˆè€…**: GLINK ãƒãƒ¼ãƒ 
